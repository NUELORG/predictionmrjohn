<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ScoreSage Admin</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23F59E0B'/%3E%3Cstop offset='100%25' stop-color='%23EF4444'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='20' cy='20' r='18' fill='none' stroke='url(%23g)' stroke-width='3'/%3E%3Cpath d='M20 8L23.5 16.5L32 20L23.5 23.5L20 32L16.5 23.5L8 20L16.5 16.5L20 8Z' fill='url(%23g)'/%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="admin-style.css">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../" class="logo">
                    <div class="logo-icon">
                        <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="20" cy="20" r="18" stroke="url(#grad1)" stroke-width="3"/>
                            <path d="M20 8L23.5 16.5L32 20L23.5 23.5L20 32L16.5 23.5L8 20L16.5 16.5L20 8Z" fill="url(#grad1)"/>
                            <defs>
                                <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#F59E0B"/>
                                    <stop offset="100%" style="stop-color:#EF4444"/>
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <span class="logo-text">Score<span class="highlight">Sage</span></span>
                </a>
            </div>
            
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item active">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    <span>Dashboard</span>
                </a>
                <a href="add.html" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                    <span>Add Prediction</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <div class="admin-info">
                    <div class="admin-avatar">A</div>
                    <div class="admin-details">
                        <span class="admin-name">Admin</span>
                        <span class="admin-role">Administrator</span>
                    </div>
                </div>
                <a href="#" class="logout-btn" id="logoutBtn" title="Logout">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                </a>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <div class="header-left">
                    <h1>Dashboard</h1>
                    <p>Manage predictions - changes show for everyone</p>
                </div>
                <div class="header-right">
                    <a href="add.html" class="btn btn-primary">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Add Prediction
                    </a>
                </div>
            </header>
            
            <div class="alert alert-success" id="successMsg" style="display: none;"></div>
            <div class="alert alert-error" id="errorMsg" style="display: none;"></div>
            
            <!-- Setup Warning -->
            <div class="alert alert-warning" id="setupWarning" style="display: none;">
                ⚠️ <strong>JSONBin not configured!</strong> Open <code>admin/admin.js</code> and add your JSONBin credentials. 
                <a href="https://jsonbin.io" target="_blank">Get free API key →</a>
            </div>
            
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon total"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg></div>
                    <div class="stat-info"><span class="stat-number" id="totalCount">-</span><span class="stat-label">Total</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon won"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg></div>
                    <div class="stat-info"><span class="stat-number" id="wonCount">-</span><span class="stat-label">Won</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon lost"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></div>
                    <div class="stat-info"><span class="stat-number" id="lostCount">-</span><span class="stat-label">Lost</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon pending"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
                    <div class="stat-info"><span class="stat-number" id="pendingCount">-</span><span class="stat-label">Pending</span></div>
                </div>
            </div>
            
            <!-- Predictions Table -->
            <div class="table-card">
                <div class="table-header">
                    <h2>Predictions</h2>
                    <span class="table-count" id="tableCount">Loading...</span>
                </div>
                
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Match</th>
                                <th>League</th>
                                <th>Date</th>
                                <th>Tip</th>
                                <th>Odds</th>
                                <th>Result</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="predictionsTable">
                            <tr><td colspan="7" class="loading-cell">Loading predictions...</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="empty-state" id="emptyState" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/><path d="M8 15h8M9 9h.01M15 9h.01"/>
                    </svg>
                    <h3>No Predictions Yet</h3>
                    <p>Add your first prediction</p>
                    <a href="add.html" class="btn btn-primary">Add Prediction</a>
                </div>
            </div>
        </main>
    </div>
    
    <script src="admin.js"></script>
    <script>
        // Check login
        if (localStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem('adminLoggedIn');
            window.location.href = 'index.html';
        });
        
        // Check if configured
        if (!isConfigured()) {
            document.getElementById('setupWarning').style.display = 'block';
        }
        
        // Load dashboard
        loadDashboard();
        
        async function loadDashboard() {
            try {
                const data = await getData();
                const predictions = data.predictions || [];
                
                // Update stats
                document.getElementById('totalCount').textContent = predictions.length;
                document.getElementById('wonCount').textContent = predictions.filter(p => p.result === 'won').length;
                document.getElementById('lostCount').textContent = predictions.filter(p => p.result === 'lost').length;
                document.getElementById('pendingCount').textContent = predictions.filter(p => p.result === 'pending').length;
                document.getElementById('tableCount').textContent = predictions.length + ' predictions';
                
                // Render table
                const tbody = document.getElementById('predictionsTable');
                const emptyState = document.getElementById('emptyState');
                
                if (predictions.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                tbody.innerHTML = predictions.map(pred => `
                    <tr>
                        <td>
                            <div class="match-info">
                                <span class="home-team">${pred.home_team}</span>
                                <span class="vs">vs</span>
                                <span class="away-team">${pred.away_team}</span>
                                ${pred.is_vip ? '<span class="vip-badge">VIP</span>' : ''}
                            </div>
                        </td>
                        <td>${pred.league_name}</td>
                        <td>
                            <div class="datetime">
                                <span class="date">${new Date(pred.match_date).toLocaleDateString('en-US', {month: 'short', day: 'numeric'})}</span>
                                <span class="time">${pred.match_time || '15:00'}</span>
                            </div>
                        </td>
                        <td><span class="prediction-tip">${pred.prediction}</span></td>
                        <td><span class="odds">${parseFloat(pred.odds).toFixed(2)}</span></td>
                        <td>
                            <select class="result-select ${pred.result || 'pending'}" onchange="updateResult(${pred.id}, this.value)">
                                <option value="pending" ${(pred.result || 'pending') === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="won" ${pred.result === 'won' ? 'selected' : ''}>Won</option>
                                <option value="lost" ${pred.result === 'lost' ? 'selected' : ''}>Lost</option>
                            </select>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <a href="edit.html?id=${pred.id}" class="btn-icon" title="Edit">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </a>
                                <button class="btn-icon delete" title="Delete" onclick="deletePrediction(${pred.id})">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('errorMsg').textContent = 'Error loading data. Please refresh.';
                document.getElementById('errorMsg').style.display = 'block';
            }
        }
        
        async function updateResult(id, result) {
            const data = await getData();
            const index = data.predictions.findIndex(p => p.id === id);
            if (index !== -1) {
                data.predictions[index].result = result;
                await saveData(data);
                loadDashboard();
            }
        }
        
        async function deletePrediction(id) {
            if (!confirm('Delete this prediction?')) return;
            
            const data = await getData();
            data.predictions = data.predictions.filter(p => p.id !== id);
            await saveData(data);
            loadDashboard();
        }
        
        // Show success message
        if (localStorage.getItem('predictionAdded')) {
            document.getElementById('successMsg').textContent = 'Prediction added successfully! Everyone can see it now.';
            document.getElementById('successMsg').style.display = 'block';
            localStorage.removeItem('predictionAdded');
            setTimeout(() => document.getElementById('successMsg').style.display = 'none', 3000);
        }
    </script>
</body>
</html>
